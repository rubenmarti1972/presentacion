<div class="model-wrapper">
  <div class="model-header">
    <p class="model-subtitle">
      Elipses de MacAdam — Umbrales de discriminación de color en el espacio CIE
    </p>
  </div>

  <div class="svg-container">
    <svg #svgContainer viewBox="0 0 400 400" class="macadam-svg">
      <defs>
        <!-- Gradiente del espectro visible -->
        <linearGradient id="cieGradientMacadam" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#8B00FF;stop-opacity:0.3" />
          <stop offset="16.7%" style="stop-color:#0000FF;stop-opacity:0.3" />
          <stop offset="33.3%" style="stop-color:#00FFFF;stop-opacity:0.3" />
          <stop offset="50%" style="stop-color:#00FF00;stop-opacity:0.3" />
          <stop offset="66.7%" style="stop-color:#FFFF00;stop-opacity:0.3" />
          <stop offset="83.3%" style="stop-color:#FF7F00;stop-opacity:0.3" />
          <stop offset="100%" style="stop-color:#FF0000;stop-opacity:0.3" />
        </linearGradient>
      </defs>

      <g class="rotating-group">
        <!-- Forma de herradura CIE (fondo) -->
        <path
          [attr.d]="getHorseshoePath()"
          fill="url(#cieGradientMacadam)"
          stroke="#555"
          stroke-width="2"
          opacity="0.5"
        />

        <!-- Elipses de MacAdam (magnificadas 10x) -->
        @for (ellipse of getMacadamEllipses(); track $index) {
          <ellipse
            [attr.cx]="ellipse.cx"
            [attr.cy]="ellipse.cy"
            [attr.rx]="ellipse.rx"
            [attr.ry]="ellipse.ry"
            [attr.transform]="'rotate(' + ellipse.rotation + ' ' + ellipse.cx + ' ' + ellipse.cy + ')'"
            fill="none"
            stroke="#00ffff"
            stroke-width="2"
            opacity="0.7"
          />
          <!-- Punto central -->
          <circle
            [attr.cx]="ellipse.cx"
            [attr.cy]="ellipse.cy"
            r="3"
            fill="#00ffff"
            stroke="#fff"
            stroke-width="1"
          />
        }

        <!-- Nota de magnificación -->
        <text x="200" y="360" text-anchor="middle" fill="#aaa" font-size="11" font-style="italic">
          Elipses magnificadas 10×
        </text>
      </g>
    </svg>
  </div>

  <p class="model-caption">
    David MacAdam demostró en 1942 que la discriminación de color no es uniforme en el espacio CIE. Las elipses muestran regiones donde el ojo humano no puede distinguir diferencias de color.
  </p>
</div>
